<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Skill Galaxy | Rudram Vyas Portfolio Game</title>
  <meta name="description" content="An interactive 3D game - Collect skills and explore Rudram's tech universe!" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="assets/favicon-new.svg" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  
  <!-- Portfolio Data -->
  <script src="../portfolio-data.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #050508;
      color: #fff;
      overflow: hidden;
      height: 100vh;
    }

    /* Game Canvas */
    #game-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    /* UI Overlay */
    .game-ui {
      position: fixed;
      z-index: 100;
      pointer-events: none;
    }

    .game-ui * {
      pointer-events: auto;
    }

    /* Header */
    .game-header {
      top: 0;
      left: 0;
      right: 0;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .game-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .game-logo-icon {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Orbitron', monospace;
      font-weight: 700;
      font-size: 18px;
    }

    .game-logo-text {
      font-family: 'Orbitron', monospace;
      font-size: 1.2rem;
      font-weight: 600;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      color: #9ca3af;
      text-decoration: none;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .back-btn:hover {
      background: rgba(168, 85, 247, 0.1);
      border-color: rgba(168, 85, 247, 0.3);
      color: #fff;
    }

    /* Score Panel */
    .score-panel {
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }

    .score-display {
      font-family: 'Orbitron', monospace;
      font-size: 3rem;
      font-weight: 700;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(168, 85, 247, 0.5);
    }

    .score-label {
      font-size: 0.75rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 3px;
      margin-top: 4px;
    }

    /* Stats Panel */
    .stats-panel {
      top: 100px;
      right: 30px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 20px;
      min-width: 220px;
    }

    .stats-title {
      font-family: 'Orbitron', monospace;
      font-size: 0.8rem;
      color: #a855f7;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .stat-item:last-child {
      border-bottom: none;
    }

    .stat-label {
      color: #9ca3af;
      font-size: 0.85rem;
    }

    .stat-value {
      font-family: 'Orbitron', monospace;
      font-weight: 600;
      color: #fff;
    }

    /* Auto-Collect Button */
    .auto-collect-btn {
      position: fixed;
      bottom: 100px;
      left: 30px;
      z-index: 100;
      padding: 15px 20px;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: #fff;
      font-family: 'Orbitron', monospace;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3);
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
    }

    .auto-collect-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(168, 85, 247, 0.5);
    }

    .auto-collect-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .auto-collect-btn i {
      font-size: 1rem;
    }

    .auto-collect-btn.active {
      background: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3); }
      50% { box-shadow: 0 6px 30px rgba(34, 197, 94, 0.6); }
    }

    /* Roaming Mode Buttons */
    .roaming-buttons {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 100;
      display: none;
      gap: 15px;
      flex-direction: column;
    }

    .roaming-buttons.show {
      display: flex;
    }

    .roaming-btn {
      padding: 12px 24px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(168, 85, 247, 0.3);
      border-radius: 12px;
      color: #fff;
      font-family: 'Orbitron', monospace;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      text-decoration: none;
    }

    .roaming-btn:hover {
      transform: translateY(-2px);
      border-color: rgba(168, 85, 247, 0.6);
      background: rgba(168, 85, 247, 0.1);
      box-shadow: 0 6px 20px rgba(168, 85, 247, 0.3);
    }

    .roaming-btn.primary {
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .roaming-btn.primary:hover {
      background: linear-gradient(135deg, #9333ea 0%, #2563eb 100%);
      box-shadow: 0 6px 20px rgba(168, 85, 247, 0.5);
    }

    /* Collected Skills */
    .collected-panel {
      bottom: 20px;
      left: 30px;
      right: 30px;
    }

    .collected-title {
      font-family: 'Orbitron', monospace;
      font-size: 0.7rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 10px;
    }

    .collected-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      max-width: 100%;
    }

    .collected-skill {
      padding: 8px 16px;
      background: rgba(168, 85, 247, 0.15);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 20px;
      font-size: 0.85rem;
      color: #c084fc;
      font-weight: 500;
      animation: skillPop 0.3s ease-out;
    }

    .collected-skill.blue {
      background: rgba(59, 130, 246, 0.15);
      border-color: rgba(59, 130, 246, 0.3);
      color: #60a5fa;
    }

    @keyframes skillPop {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Controls Help */
    .controls-panel {
      bottom: 20px;
      right: 30px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 15px 20px;
    }

    .controls-title {
      font-family: 'Orbitron', monospace;
      font-size: 0.7rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 10px;
    }

    .control-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .control-row:last-child {
      margin-bottom: 0;
    }

    .key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      height: 28px;
      padding: 0 8px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      font-family: 'Orbitron', monospace;
      font-size: 0.7rem;
      font-weight: 600;
    }

    /* Start Screen */
    .start-screen {
      position: fixed;
      inset: 0;
      z-index: 200;
      background: rgba(5, 5, 8, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
    }

    .start-screen.hidden {
      display: none;
    }

    .start-screen-back {
      position: absolute;
      top: 20px;
      right: 30px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      color: #9ca3af;
      text-decoration: none;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .start-screen-back:hover {
      background: rgba(168, 85, 247, 0.1);
      border-color: rgba(168, 85, 247, 0.3);
      color: #fff;
    }

    .game-title {
      font-family: 'Orbitron', monospace;
      font-size: clamp(2rem, 8vw, 4rem);
      font-weight: 800;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 50%, #06b6d4 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { filter: drop-shadow(0 0 20px rgba(168, 85, 247, 0.5)); }
      to { filter: drop-shadow(0 0 40px rgba(59, 130, 246, 0.8)); }
    }

    .game-subtitle {
      font-size: 1.1rem;
      color: #9ca3af;
      margin-bottom: 40px;
      max-width: 500px;
    }

    .game-subtitle span {
      color: #c084fc;
      font-weight: 600;
    }

    .start-btn {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 18px 50px;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      border: none;
      border-radius: 50px;
      color: #fff;
      font-family: 'Orbitron', monospace;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 40px rgba(168, 85, 247, 0.4);
    }

    .start-btn:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 15px 50px rgba(168, 85, 247, 0.6);
    }

    .objective-box {
      margin-top: 50px;
      padding: 25px 35px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      text-align: left;
    }

    .objective-title {
      font-family: 'Orbitron', monospace;
      font-size: 0.8rem;
      color: #a855f7;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 15px;
    }

    .objective-list {
      list-style: none;
    }

    .objective-list li {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
      color: #d1d5db;
      font-size: 0.95rem;
    }

    .objective-list li:last-child {
      margin-bottom: 0;
    }

    .objective-list i {
      color: #a855f7;
      width: 20px;
    }

    /* Skill Popup */
    .skill-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      z-index: 150;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 20px;
      padding: 30px 40px;
      text-align: center;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .skill-popup.show {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }

    .skill-popup-icon {
      width: 60px;
      height: 60px;
      margin: 0 auto 15px;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .skill-popup-name {
      font-family: 'Orbitron', monospace;
      font-size: 1.5rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }

    .skill-popup-fact {
      color: #9ca3af;
      font-size: 0.9rem;
      max-width: 300px;
      line-height: 1.5;
    }

    .skill-popup-points {
      margin-top: 15px;
      font-family: 'Orbitron', monospace;
      font-size: 1.2rem;
      color: #22c55e;
    }

    /* Win Screen */
    .win-screen {
      position: fixed;
      inset: 0;
      z-index: 200;
      background: rgba(5, 5, 8, 0.95);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
    }

    .win-screen.show {
      display: flex;
    }

    .win-title {
      font-family: 'Orbitron', monospace;
      font-size: clamp(2rem, 6vw, 3rem);
      font-weight: 800;
      background: linear-gradient(135deg, #22c55e 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 20px;
    }

    .final-score {
      font-family: 'Orbitron', monospace;
      font-size: 4rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 10px;
    }

    .final-score-label {
      color: #6b7280;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 30px;
    }

    .win-message {
      color: #9ca3af;
      font-size: 1rem;
      max-width: 500px;
      margin-bottom: 40px;
      line-height: 1.6;
    }

    .win-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .continue-exploring-btn {
      padding: 15px 40px;
      background: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
      border: none;
      border-radius: 50px;
      color: #fff;
      font-family: 'Orbitron', monospace;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
    }

    .continue-exploring-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4);
    }

    .play-again-btn {
      padding: 15px 40px;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      border: none;
      border-radius: 50px;
      color: #fff;
      font-family: 'Orbitron', monospace;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
    }

    .play-again-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(168, 85, 247, 0.4);
    }

    .back-portfolio-btn {
      padding: 15px 40px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50px;
      color: #fff;
      font-family: 'Orbitron', monospace;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
    }

    .back-portfolio-btn:hover {
      transform: translateY(-3px);
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 10px 30px rgba(255, 255, 255, 0.1);
    }

    /* Mobile Controls */
    .mobile-controls {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 100;
    }

    .joystick-base {
      width: 110px;
      height: 110px;
      background: rgba(255, 255, 255, 0.08);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      position: relative;
      touch-action: none;
    }

    .joystick-stick {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      touch-action: none;
      box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);
    }

    /* Mobile Action Buttons */
    .mobile-action-buttons {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 100;
      gap: 12px;
      flex-direction: column;
      align-items: flex-end;
    }

    .mobile-action-btn {
      width: 65px;
      height: 65px;
      background: rgba(255, 255, 255, 0.08);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
      touch-action: none;
      user-select: none;
    }

    .mobile-action-btn:active {
      background: rgba(168, 85, 247, 0.3);
      border-color: rgba(168, 85, 247, 0.5);
      transform: scale(0.95);
      box-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
    }

    .mobile-action-btn.boost {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(59, 130, 246, 0.2));
      border-color: rgba(168, 85, 247, 0.4);
    }

    .mobile-action-btn.boost:active {
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.4), rgba(59, 130, 246, 0.4));
    }

    .mobile-action-btn-label {
      font-size: 0.65rem;
      margin-top: 4px;
      opacity: 0.8;
    }

    /* Mobile Hamburger Menu */
    .mobile-menu-btn {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 120;
      width: 45px;
      height: 45px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .mobile-menu-btn:hover {
      background: rgba(168, 85, 247, 0.3);
      border-color: rgba(168, 85, 247, 0.5);
    }

    .mobile-ui-panel {
      display: none;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 280px;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      border-left: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 110;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      overflow-y: auto;
      padding: 80px 20px 20px;
    }

    .mobile-ui-panel.open {
      transform: translateX(0);
    }

    @media (max-width: 768px) {
      .mobile-controls {
        display: block;
      }

      .mobile-action-buttons {
        display: flex;
      }

      .mobile-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .controls-panel {
        display: none !important;
      }

      .stats-panel,
      .collected-panel,
      .auto-collect-btn {
        display: none;
      }

      .stats-panel.mobile-visible,
      .collected-panel.mobile-visible,
      .auto-collect-btn.mobile-visible {
        display: block;
        position: static;
        margin-bottom: 15px;
      }
      }

    /* Responsive */
    @media (max-width: 480px) {
      .game-header {
        padding: 15px;
      }

      .score-display {
        font-size: 2rem;
      }

      .stats-panel {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Game Canvas -->
  <canvas id="game-canvas"></canvas>

  <!-- Start Screen -->
  <div class="start-screen" id="start-screen">
    <a href="profile4.html" class="start-screen-back">
      <i class="fas fa-arrow-left"></i>
      Back to Portfolio
    </a>
    
    <h1 class="game-title">SKILL GALAXY</h1>
    <p class="game-subtitle">
      Navigate the cosmos and collect <span>Rudram's tech skills</span>! 
      Each skill reveals a fact from his journey.
    </p>
    
    <button class="start-btn" id="start-btn">
      <i class="fas fa-rocket"></i>
      Launch Game
    </button>

    <div class="objective-box">
      <div class="objective-title">
        <i class="fas fa-bullseye"></i> Mission Objectives
      </div>
      <ul class="objective-list">
        <li><i class="fas fa-star"></i> Collect all 15 floating skill orbs</li>
        <li><i class="fas fa-lightbulb"></i> Learn facts about each technology</li>
        <li><i class="fas fa-trophy"></i> Complete your tech stack collection</li>
        <li><i class="fas fa-clock"></i> Beat your best time!</li>
      </ul>
    </div>
    
    <div class="objective-box" style="margin-top: 20px;">
      <div class="objective-title">
        <i class="fas fa-gamepad"></i> Controls
      </div>
      <ul class="objective-list">
        <li><i class="fas fa-arrows-alt"></i> WASD or Arrow Keys to move, SPACE to rise, SHIFT to descend</li>
        <li><i class="fas fa-rocket"></i> CAPS (or Mac ⌘/⌥) for speed boost</li>
      </ul>
    </div>
  </div>

  <!-- Game UI -->
  <div class="game-ui game-header" id="game-ui" style="display: none;">
    <div class="game-logo">
      <div class="game-logo-icon">RV</div>
      <div class="game-logo-text">SKILL GALAXY</div>
    </div>
    <div style="display: flex; gap: 10px;">
      <a href="explore.html" class="back-btn" style="background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.2);">
        <i class="fas fa-cube"></i>
        Explore 3D
      </a>
      <a href="profile4.html" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Portfolio
      </a>
    </div>
  </div>

  <div class="game-ui score-panel" id="score-panel" style="display: none;">
    <div class="score-display" id="score">0</div>
    <div class="score-label">Skills Collected</div>
  </div>

  <div class="game-ui stats-panel" id="stats-panel" style="display: none;">
    <div class="stats-title">
      <i class="fas fa-chart-bar"></i> Stats
    </div>
    <div class="stat-item">
      <span class="stat-label">Time</span>
      <span class="stat-value" id="timer">0:00</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Remaining</span>
      <span class="stat-value" id="remaining">15</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Speed</span>
      <span class="stat-value" id="speed-display">Normal</span>
    </div>
  </div>

  <!-- Auto-Collect Button -->
  <button class="auto-collect-btn" id="auto-collect-btn" style="display: none;">
    <i class="fas fa-magic"></i>
    <span>Auto Collect</span>
  </button>

  <div class="game-ui collected-panel" id="collected-panel" style="display: none;">
    <div class="collected-title">Collected Skills</div>
    <div class="collected-skills" id="collected-skills"></div>
  </div>

  <div class="game-ui controls-panel" id="controls-panel" style="display: none;">
    <div class="controls-title">Controls</div>
    <div class="control-row">
      <span class="key">WASD</span>
      <span class="key">↑←↓→</span>
      <span>Move</span>
    </div>
    <div class="control-row">
      <span class="key">SPACE</span>
      <span>Rise</span>
    </div>
    <div class="control-row">
      <span class="key">SHIFT</span>
      <span>Descend</span>
    </div>
    <div class="control-row">
      <span class="key">CAPS</span>
      <span>Boost</span>
    </div>
    <div class="control-row" style="font-size: 0.75rem; opacity: 0.7; margin-top: 4px;">
      <span>Mac: ⌘ Cmd or ⌥ Option for Boost</span>
    </div>
  </div>

  <!-- Mobile Hamburger Button -->
  <button class="mobile-menu-btn" id="mobile-menu-btn" style="display: none;">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Mobile UI Panel -->
  <div class="mobile-ui-panel" id="mobile-ui-panel">
    <div id="mobile-stats-container"></div>
    <div id="mobile-collected-container"></div>
    <div id="mobile-autocollect-container"></div>
  </div>

  <!-- Mobile Joystick -->
  <div class="mobile-controls" id="mobile-controls">
    <div class="joystick-base" id="joystick-base">
      <div class="joystick-stick" id="joystick-stick"></div>
    </div>
  </div>

  <!-- Mobile Action Buttons -->
  <div class="mobile-action-buttons" id="mobile-action-buttons">
    <button class="mobile-action-btn boost" id="mobile-boost-btn" data-action="boost">
      <div style="text-align: center;">
        <i class="fas fa-rocket"></i>
        <div class="mobile-action-btn-label">BOOST</div>
      </div>
    </button>
    <button class="mobile-action-btn" id="mobile-rise-btn" data-action="rise">
      <div style="text-align: center;">
        <i class="fas fa-arrow-up"></i>
        <div class="mobile-action-btn-label">RISE</div>
      </div>
    </button>
    <button class="mobile-action-btn" id="mobile-descend-btn" data-action="descend">
      <div style="text-align: center;">
        <i class="fas fa-arrow-down"></i>
        <div class="mobile-action-btn-label">DESCEND</div>
      </div>
    </button>
  </div>

  <!-- Skill Popup -->
  <div class="skill-popup" id="skill-popup">
    <div class="skill-popup-icon"><i class="fas fa-code"></i></div>
    <div class="skill-popup-name" id="popup-skill-name">React</div>
    <div class="skill-popup-fact" id="popup-skill-fact">Used at ShopR to boost user engagement by 40%</div>
    <div class="skill-popup-points">+100 pts</div>
  </div>

  <!-- Win Screen -->
  <div class="win-screen" id="win-screen">
    <h1 class="win-title">MISSION COMPLETE!</h1>
    <div class="final-score" id="final-score">1500</div>
    <div class="final-score-label">Total Points</div>
    <p class="win-message">
      You've collected Rudram's complete tech stack! These are the skills he uses to build 
      scalable, user-friendly applications. Interested in working together?
    </p>
    <div class="win-buttons">
      <button class="continue-exploring-btn" id="continue-exploring-btn">
        <i class="fas fa-eye"></i> Continue Exploring
      </button>
      <button class="play-again-btn" id="play-again-btn">
        <i class="fas fa-redo"></i> Play Again
      </button>
      <a href="profile4.html#contact" class="back-portfolio-btn">
        <i class="fas fa-envelope"></i> Get in Touch
      </a>
    </div>
  </div>

  <!-- Roaming Mode Buttons -->
  <div class="roaming-buttons" id="roaming-buttons">
    <button class="roaming-btn primary" id="show-results-btn">
      <i class="fas fa-trophy"></i>
      View Results
    </button>
    <button class="roaming-btn" id="restart-roaming-btn">
      <i class="fas fa-redo"></i>
      Play Again
    </button>
    <a href="mailto:rudram.vyas@gmail.com" class="roaming-btn">
      <i class="fas fa-envelope"></i>
      Contact Me
    </a>
  </div>

  <script>
    // ===== SKILL DATA (From portfolio-data.js) =====
    const skills = PORTFOLIO_DATA.gameSkills;

    // ===== THREE.JS SETUP =====
    const canvas = document.getElementById('game-canvas');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
    
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setClearColor(0x050508);

    // ===== LIGHTING =====
    const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
    scene.add(ambientLight);

    const purpleLight = new THREE.PointLight(0xa855f7, 2, 100);
    purpleLight.position.set(20, 20, 20);
    scene.add(purpleLight);

    const blueLight = new THREE.PointLight(0x3b82f6, 2, 100);
    blueLight.position.set(-20, -20, 20);
    scene.add(blueLight);

    // ===== STARFIELD BACKGROUND =====
    const starGeometry = new THREE.BufferGeometry();
    const starCount = 2000;
    const starPositions = new Float32Array(starCount * 3);
    
    for (let i = 0; i < starCount * 3; i += 3) {
      starPositions[i] = (Math.random() - 0.5) * 300;
      starPositions[i + 1] = (Math.random() - 0.5) * 300;
      starPositions[i + 2] = (Math.random() - 0.5) * 300;
    }
    
    starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));
    const starMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5, transparent: true, opacity: 0.8 });
    const stars = new THREE.Points(starGeometry, starMaterial);
    scene.add(stars);

    // ===== PLAYER =====
    const playerGeometry = new THREE.IcosahedronGeometry(0.8, 2);
    const playerMaterial = new THREE.MeshPhysicalMaterial({
      color: 0xa855f7,
      metalness: 0.3,
      roughness: 0.2,
      emissive: 0xa855f7,
      emissiveIntensity: 0.3,
    });
    const player = new THREE.Mesh(playerGeometry, playerMaterial);
    player.position.set(0, 0, 0);
    scene.add(player);

    // Player glow
    const glowGeometry = new THREE.SphereGeometry(1.2, 32, 32);
    const glowMaterial = new THREE.MeshBasicMaterial({
      color: 0xa855f7,
      transparent: true,
      opacity: 0.15,
    });
    const playerGlow = new THREE.Mesh(glowGeometry, glowMaterial);
    player.add(playerGlow);

    // Player trail
    const trailParticles = [];
    const trailGeometry = new THREE.SphereGeometry(0.1, 8, 8);
    const trailMaterial = new THREE.MeshBasicMaterial({ color: 0xa855f7, transparent: true });

    // ===== SKILL ORBS =====
    const skillOrbs = [];
    const orbGroup = new THREE.Group();
    scene.add(orbGroup);

    function createSkillOrb(skill, index) {
      const geometry = new THREE.OctahedronGeometry(1, 0);
      const material = new THREE.MeshPhysicalMaterial({
        color: skill.color,
        metalness: 0.4,
        roughness: 0.1,
        emissive: skill.color,
        emissiveIntensity: 0.2,
        transparent: true,
        opacity: 0.9,
      });
      
      const orb = new THREE.Mesh(geometry, material);
      
      // Position in a sphere around the player
      const phi = Math.acos(-1 + (2 * index) / skills.length);
      const theta = Math.sqrt(skills.length * Math.PI) * phi;
      const radius = 25 + Math.random() * 20;
      
      orb.position.x = radius * Math.cos(theta) * Math.sin(phi);
      orb.position.y = radius * Math.sin(theta) * Math.sin(phi) * 0.5;
      orb.position.z = radius * Math.cos(phi);
      
      // Outer glow
      const glowGeo = new THREE.SphereGeometry(1.5, 16, 16);
      const glowMat = new THREE.MeshBasicMaterial({
        color: skill.color,
        transparent: true,
        opacity: 0.2,
      });
      const glow = new THREE.Mesh(glowGeo, glowMat);
      orb.add(glow);

      orb.userData = { 
        skill, 
        collected: false,
        baseY: orb.position.y,
        phase: Math.random() * Math.PI * 2,
        rotSpeed: 0.01 + Math.random() * 0.02
      };
      
      orbGroup.add(orb);
      skillOrbs.push(orb);
    }

    // Create all skill orbs
    skills.forEach((skill, i) => createSkillOrb(skill, i));

    // ===== GAME STATE =====
    let gameStarted = false;
    let score = 0;
    let collected = 0;
    let gameTime = 0;
    let lastTime = 0;

    // ===== CONTROLS =====
    const keys = { w: false, a: false, s: false, d: false, shift: false, space: false, capslock: false };
    const velocity = new THREE.Vector3();
    const acceleration = 0.015;
    const maxSpeed = 0.4;
    const boostMultiplier = 2;
    const friction = 0.98;

    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'w' || e.key === 'ArrowUp') keys.w = true;
      if (e.key.toLowerCase() === 'a' || e.key === 'ArrowLeft') keys.a = true;
      if (e.key.toLowerCase() === 's' || e.key === 'ArrowDown') keys.s = true;
      if (e.key.toLowerCase() === 'd' || e.key === 'ArrowRight') keys.d = true;
      if (e.key === 'Shift') keys.shift = true;
      if (e.key === ' ') keys.space = true;
      if (e.key === 'CapsLock' || e.key === 'Meta' || e.key === 'Alt') keys.capslock = true; // CapsLock or Mac Cmd/Option
    });

    document.addEventListener('keyup', (e) => {
      if (e.key.toLowerCase() === 'w' || e.key === 'ArrowUp') keys.w = false;
      if (e.key.toLowerCase() === 'a' || e.key === 'ArrowLeft') keys.a = false;
      if (e.key.toLowerCase() === 's' || e.key === 'ArrowDown') keys.s = false;
      if (e.key.toLowerCase() === 'd' || e.key === 'ArrowRight') keys.d = false;
      if (e.key === 'Shift') keys.shift = false;
      if (e.key === ' ') keys.space = false;
      if (e.key === 'CapsLock' || e.key === 'Meta' || e.key === 'Alt') keys.capslock = false;
    });

    // Mobile joystick
    const joystickBase = document.getElementById('joystick-base');
    const joystickStick = document.getElementById('joystick-stick');
    let joystickActive = false;
    let joystickX = 0, joystickY = 0;

    if (joystickBase) {
      joystickBase.addEventListener('touchstart', (e) => {
        joystickActive = true;
        e.preventDefault();
      });

      document.addEventListener('touchmove', (e) => {
        if (!joystickActive) return;
        const touch = e.touches[0];
        const rect = joystickBase.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        joystickX = (touch.clientX - centerX) / (rect.width / 2);
        joystickY = (touch.clientY - centerY) / (rect.height / 2);
        
        joystickX = Math.max(-1, Math.min(1, joystickX));
        joystickY = Math.max(-1, Math.min(1, joystickY));
        
        joystickStick.style.transform = `translate(calc(-50% + ${joystickX * 35}px), calc(-50% + ${joystickY * 35}px))`;
      });

      document.addEventListener('touchend', () => {
        joystickActive = false;
        joystickX = 0;
        joystickY = 0;
        joystickStick.style.transform = 'translate(-50%, -50%)';
      });
    }

    // Mobile action buttons
    const mobileRiseBtn = document.getElementById('mobile-rise-btn');
    const mobileDescendBtn = document.getElementById('mobile-descend-btn');
    const mobileBoostBtn = document.getElementById('mobile-boost-btn');

    if (mobileRiseBtn) {
      mobileRiseBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        keys.space = true;
      });
      mobileRiseBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        keys.space = false;
      });
    }

    if (mobileDescendBtn) {
      mobileDescendBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        keys.shift = true;
      });
      mobileDescendBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        keys.shift = false;
      });
    }

    if (mobileBoostBtn) {
      mobileBoostBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        keys.capslock = true;
      });
      mobileBoostBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        keys.capslock = false;
      });
    }

    // Mobile hamburger menu
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileUIPanel = document.getElementById('mobile-ui-panel');
    
    if (mobileMenuBtn && mobileUIPanel) {
      mobileMenuBtn.addEventListener('click', () => {
        mobileUIPanel.classList.toggle('open');
        const icon = mobileMenuBtn.querySelector('i');
        icon.classList.toggle('fa-bars');
        icon.classList.toggle('fa-times');
      });

      // Close panel when clicking outside (on canvas)
      document.addEventListener('click', (e) => {
        if (!mobileUIPanel.contains(e.target) && !mobileMenuBtn.contains(e.target) && mobileUIPanel.classList.contains('open')) {
          mobileUIPanel.classList.remove('open');
          const icon = mobileMenuBtn.querySelector('i');
          icon.classList.add('fa-bars');
          icon.classList.remove('fa-times');
        }
      });
    }

    // Move UI panels to mobile menu on small screens
    function setupMobileUI() {
      if (window.innerWidth <= 768) {
        const statsPanel = document.getElementById('stats-panel');
        const collectedPanel = document.getElementById('collected-panel');
        const autoCollectBtn = document.getElementById('auto-collect-btn');
        const mobileStatsContainer = document.getElementById('mobile-stats-container');
        const mobileCollectedContainer = document.getElementById('mobile-collected-container');
        const mobileAutoCollectContainer = document.getElementById('mobile-autocollect-container');

        if (statsPanel && mobileStatsContainer) {
          mobileStatsContainer.appendChild(statsPanel.cloneNode(true));
          statsPanel.style.display = 'none';
        }
        if (collectedPanel && mobileCollectedContainer) {
          mobileCollectedContainer.appendChild(collectedPanel.cloneNode(true));
          collectedPanel.style.display = 'none';
        }
        if (autoCollectBtn && mobileAutoCollectContainer) {
          const clonedBtn = autoCollectBtn.cloneNode(true);
          clonedBtn.style.position = 'static';
          clonedBtn.style.width = '100%';
          clonedBtn.style.marginBottom = '15px';
          mobileAutoCollectContainer.appendChild(clonedBtn);
          autoCollectBtn.style.display = 'none';
          
          // Re-attach event listener
          clonedBtn.addEventListener('click', toggleAutoCollect);
        }
      }
    }

    // ===== CAMERA FOLLOW =====
    const cameraOffset = new THREE.Vector3(0, 5, 15);
    camera.position.copy(player.position).add(cameraOffset);
    camera.lookAt(player.position);

    // ===== UI ELEMENTS =====
    const startScreen = document.getElementById('start-screen');
    const gameUI = document.getElementById('game-ui');
    const scorePanel = document.getElementById('score-panel');
    const statsPanel = document.getElementById('stats-panel');
    const collectedPanel = document.getElementById('collected-panel');
    const controlsPanel = document.getElementById('controls-panel');
    const mobileControls = document.getElementById('mobile-controls');
    const skillPopup = document.getElementById('skill-popup');
    const winScreen = document.getElementById('win-screen');

    const scoreDisplay = document.getElementById('score');
    const timerDisplay = document.getElementById('timer');
    const remainingDisplay = document.getElementById('remaining');
    const speedDisplay = document.getElementById('speed-display');
    const collectedSkillsContainer = document.getElementById('collected-skills');

    // ===== START GAME =====
    document.getElementById('start-btn').addEventListener('click', startGame);
    document.getElementById('play-again-btn').addEventListener('click', resetGame);
    document.getElementById('restart-roaming-btn').addEventListener('click', resetGame);
    
    // ===== ROAMING MODE =====
    let roamingMode = false;
    
    document.getElementById('continue-exploring-btn').addEventListener('click', () => {
      winScreen.classList.remove('show');
      roamingMode = true;
      gameStarted = true; // Allow movement
      document.getElementById('roaming-buttons').classList.add('show');
    });
    
    document.getElementById('show-results-btn').addEventListener('click', () => {
      roamingMode = false;
      winScreen.classList.add('show');
      document.getElementById('roaming-buttons').classList.remove('show');
    });

    function startGame() {
      gameStarted = true;
      startScreen.classList.add('hidden');
      gameUI.style.display = 'flex';
      scorePanel.style.display = 'block';
      statsPanel.style.display = 'block';
      collectedPanel.style.display = 'block';
      controlsPanel.style.display = 'block';
      document.getElementById('auto-collect-btn').style.display = 'flex';
      setupMobileUI();
      lastTime = performance.now();
    }

    function resetGame() {
      // Reset player
      player.position.set(0, 0, 0);
      velocity.set(0, 0, 0);
      
      // Reset orbs
      orbGroup.clear();
      skillOrbs.length = 0;
      skills.forEach((skill, i) => createSkillOrb(skill, i));
      
      // Reset state
      score = 0;
      collected = 0;
      gameTime = 0;
      
      // Reset UI
      scoreDisplay.textContent = '0';
      timerDisplay.textContent = '0:00';
      remainingDisplay.textContent = skills.length;
      collectedSkillsContainer.innerHTML = '';
      
      // Hide win screen and roaming buttons, show game
      winScreen.classList.remove('show');
      document.getElementById('roaming-buttons').classList.remove('show');
      roamingMode = false;
      startGame();
    }

    // ===== AUTO-COLLECT FUNCTIONALITY =====
    let autoCollecting = false;
    let autoCollectTargetOrb = null;
    const autoCollectSpeed = 0.3;
    const autoCollectPauseTime = 2500; // Pause to read skill info
    
    document.getElementById('auto-collect-btn').addEventListener('click', toggleAutoCollect);
    
    function toggleAutoCollect() {
      const btn = document.getElementById('auto-collect-btn');
      if (autoCollecting) {
        autoCollecting = false;
        autoCollectTargetOrb = null;
        btn.classList.remove('active');
        btn.innerHTML = '<i class="fas fa-magic"></i><span>Auto Collect</span>';
      } else {
        autoCollecting = true;
        btn.classList.add('active');
        btn.innerHTML = '<i class="fas fa-stop-circle"></i><span>Stop</span>';
        findNextOrbToCollect();
      }
    }
    
    function findNextOrbToCollect() {
      if (!autoCollecting || skillOrbs.length === 0) {
        autoCollecting = false;
        const btn = document.getElementById('auto-collect-btn');
        btn.classList.remove('active');
        btn.innerHTML = '<i class="fas fa-magic"></i><span>Auto Collect</span>';
        return;
      }
      
      // Find nearest orb that hasn't been collected
      let nearest = null;
      let nearestDist = Infinity;
      
      skillOrbs.forEach(orb => {
        if (!orb.userData.collected) {
          const dist = player.position.distanceTo(orb.position);
          if (dist < nearestDist) {
            nearestDist = dist;
            nearest = orb;
          }
        }
      });
      
      autoCollectTargetOrb = nearest;
    }
    
    function updateAutoCollect() {
      if (!autoCollecting || !autoCollectTargetOrb) return;
      
      const direction = new THREE.Vector3()
        .subVectors(autoCollectTargetOrb.position, player.position)
        .normalize();
      
      const distance = player.position.distanceTo(autoCollectTargetOrb.position);
      
      if (distance < 2.5) {
        // Collect the orb
        const skill = autoCollectTargetOrb.userData.skill;
        
        // Mark as collected
        autoCollectTargetOrb.userData.collected = true;
        
        // Update score
        score += skill.points;
        collected++;
        scoreDisplay.textContent = collected;
        remainingDisplay.textContent = skills.length - collected;
        
        // Show popup and add to UI
        showSkillPopup(skill);
        addCollectedSkill(skill);
        
        // Remove orb from scene
        orbGroup.remove(autoCollectTargetOrb);
        const index = skillOrbs.indexOf(autoCollectTargetOrb);
        if (index !== -1) {
          skillOrbs.splice(index, 1);
        }
        
        // Check win
        if (collected >= skills.length) {
          checkWin();
          return;
        }
        
        // Pause before moving to next orb
        autoCollectTargetOrb = null;
        setTimeout(() => {
          if (autoCollecting) {
            findNextOrbToCollect();
          }
        }, autoCollectPauseTime);
      } else {
        // Move towards orb
        velocity.copy(direction).multiplyScalar(autoCollectSpeed);
        player.position.add(velocity);
        player.rotation.x += direction.z * 0.05;
        player.rotation.z -= direction.x * 0.05;
      }
    }

    // ===== SHOW SKILL POPUP =====
    function showSkillPopup(skill) {
      document.getElementById('popup-skill-name').textContent = skill.name;
      document.getElementById('popup-skill-fact').textContent = skill.fact;
      skillPopup.classList.add('show');
      
      setTimeout(() => {
        skillPopup.classList.remove('show');
      }, 2000);
    }

    // ===== ADD COLLECTED SKILL TO UI =====
    function addCollectedSkill(skill) {
      const skillEl = document.createElement('span');
      skillEl.className = 'collected-skill' + (skill.color === 0x3b82f6 ? ' blue' : '');
      skillEl.textContent = skill.name;
      collectedSkillsContainer.appendChild(skillEl);
    }

    // ===== FINISHING EFFECTS =====
    function createFinishingEffects() {
      // Create colorful particle explosion
      const particleCount = 100;
      const particles = [];
      const particleGeometry = new THREE.SphereGeometry(0.3, 8, 8);
      
      for (let i = 0; i < particleCount; i++) {
        const colors = [0xa855f7, 0x3b82f6, 0x06b6d4, 0x22c55e, 0xfbbf24, 0xec4899];
        const color = colors[Math.floor(Math.random() * colors.length)];
        const material = new THREE.MeshBasicMaterial({ color, transparent: true });
        const particle = new THREE.Mesh(particleGeometry, material);
        
        particle.position.copy(player.position);
        particle.userData = {
          velocity: new THREE.Vector3(
            (Math.random() - 0.5) * 2,
            (Math.random() - 0.5) * 2,
            (Math.random() - 0.5) * 2
          ).multiplyScalar(0.5),
          life: 1.0
        };
        
        scene.add(particle);
        particles.push(particle);
      }
      
      // Animate particles
      const animateParticles = () => {
        let allDead = true;
        particles.forEach(particle => {
          if (particle.userData.life > 0) {
            allDead = false;
            particle.position.add(particle.userData.velocity);
            particle.userData.velocity.y -= 0.01; // Gravity
            particle.userData.life -= 0.02;
            particle.material.opacity = particle.userData.life;
            particle.scale.set(particle.userData.life, particle.userData.life, particle.userData.life);
          }
        });
        
        if (!allDead) {
          requestAnimationFrame(animateParticles);
        } else {
          particles.forEach(p => scene.remove(p));
        }
      };
      animateParticles();
      
      // Screen flash effect
      const flash = document.createElement('div');
      flash.style.cssText = `
        position: fixed;
        inset: 0;
        background: radial-gradient(circle, rgba(168, 85, 247, 0.3) 0%, transparent 70%);
        z-index: 150;
        pointer-events: none;
        animation: flashFade 1s ease-out forwards;
      `;
      document.body.appendChild(flash);
      setTimeout(() => flash.remove(), 1000);
      
      // Add flash animation
      if (!document.getElementById('flash-animation')) {
        const style = document.createElement('style');
        style.id = 'flash-animation';
        style.textContent = `
          @keyframes flashFade {
            0% { opacity: 1; }
            100% { opacity: 0; }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // ===== CHECK WIN =====
    function checkWin() {
      if (collected >= skills.length) {
        // Stop auto-collect if active
        if (autoCollecting) {
          autoCollecting = false;
          autoCollectTargetOrb = null;
          const btn = document.getElementById('auto-collect-btn');
          btn.classList.remove('active');
          btn.innerHTML = '<i class="fas fa-magic"></i><span>Auto Collect</span>';
        }
        
        // Create finishing effects
        createFinishingEffects();
        
        // Wait longer for effects before showing win screen
        setTimeout(() => {
          gameStarted = false;
          document.getElementById('final-score').textContent = score;
          winScreen.classList.add('show');
          
          // Hide game UI
          gameUI.style.display = 'none';
          scorePanel.style.display = 'none';
          statsPanel.style.display = 'none';
          collectedPanel.style.display = 'none';
          controlsPanel.style.display = 'none';
          document.getElementById('auto-collect-btn').style.display = 'none';
        }, 2500); // Increased from 800ms to 2500ms
      }
    }

    // ===== ANIMATION LOOP =====
    function animate(currentTime) {
      requestAnimationFrame(animate);

      if (gameStarted) {
        // Update timer
        const deltaTime = (currentTime - lastTime) / 1000;
        lastTime = currentTime;
        gameTime += deltaTime;
        
        const minutes = Math.floor(gameTime / 60);
        const seconds = Math.floor(gameTime % 60);
        timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

        // Auto-collect or manual movement
        if (autoCollecting) {
          updateAutoCollect();
        } else {
          // Apply movement
          const boost = keys.capslock ? boostMultiplier : 1;
          speedDisplay.textContent = keys.capslock ? 'BOOST!' : 'Normal';
          
          // Keyboard controls
          if (keys.w) velocity.z -= acceleration * boost;
          if (keys.s) velocity.z += acceleration * boost;
          if (keys.a) velocity.x -= acceleration * boost;
          if (keys.d) velocity.x += acceleration * boost;
          if (keys.space) velocity.y += acceleration * boost * 0.5;
          if (keys.shift) velocity.y -= acceleration * boost * 0.5;
          
          // Mobile controls
          if (joystickActive) {
            velocity.x += joystickX * acceleration * 2;
            velocity.z += joystickY * acceleration * 2;
          }
          
          // Clamp velocity
          velocity.clampLength(0, maxSpeed * boost);
          
          // Apply friction
          velocity.multiplyScalar(friction);
          
          // Update player position
          player.position.add(velocity);
          
          // Keep player in bounds
          player.position.clamp(
            new THREE.Vector3(-60, -30, -60),
            new THREE.Vector3(60, 30, 60)
          );
          
          // Player rotation based on velocity
          player.rotation.x += velocity.z * 0.1;
          player.rotation.z -= velocity.x * 0.1;
        }

        // Check collisions with orbs (only when not auto-collecting)
        if (!autoCollecting) {
          skillOrbs.forEach((orb) => {
            if (!orb.userData.collected) {
              const distance = player.position.distanceTo(orb.position);
              if (distance < 2.5) {
                orb.userData.collected = true;
              collected++;
              score += orb.userData.skill.points;
              
              // Update UI
              scoreDisplay.textContent = collected;
              remainingDisplay.textContent = skills.length - collected;
              
              // Show popup
              showSkillPopup(orb.userData.skill);
              addCollectedSkill(orb.userData.skill);
              
              // Animate orb collection
              const scale = { value: 1 };
              const animateCollect = () => {
                scale.value *= 0.9;
                orb.scale.setScalar(scale.value);
                orb.material.opacity = scale.value;
                if (scale.value > 0.01) {
                  requestAnimationFrame(animateCollect);
                } else {
                  orbGroup.remove(orb);
                }
              };
              animateCollect();
              
              // Check win
              checkWin();
            }
          }
          });
        }

        // Camera follow
        const targetCameraPos = player.position.clone().add(cameraOffset);
        camera.position.lerp(targetCameraPos, 0.05);
        camera.lookAt(player.position);
      }

      // Animate orbs
      skillOrbs.forEach((orb) => {
        if (!orb.userData.collected) {
          orb.rotation.x += orb.userData.rotSpeed;
          orb.rotation.y += orb.userData.rotSpeed * 1.5;
          orb.position.y = orb.userData.baseY + Math.sin(Date.now() * 0.001 + orb.userData.phase) * 0.5;
        }
      });

      // Animate stars
      stars.rotation.y += 0.0001;

      // Animate lights
      purpleLight.position.x = 20 + Math.sin(Date.now() * 0.001) * 10;
      blueLight.position.x = -20 + Math.cos(Date.now() * 0.001) * 10;

      renderer.render(scene, camera);
    }

    // Start animation
    animate(0);

    // ===== RESIZE =====
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>

